<%- include('../partials/header') %>
<br>
<nav class="breadcrumb is-small" aria-label="breadcrumbs">
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/recipes">All Recipes</a></li>
        <li class="is-active"><a href="#" aria-current="page">Recipe: <%= recipe.name %></a></li>
    </ul>
</nav>

    <section class="hero is-small">
        <div class="hero-body">
            <p class="title"><%= recipe.name %></p>
            <p class="subtitle"><%= recipe.description %></p>
        </div>
    </section>
    <br>


<!-- image -->
    <div>
        <% if (recipe.imageUrl) { %>
            <img src="<%= recipe.imageUrl %>" alt="Recipe Image" style="width: 30%; height: auto">
            <% } else { %>
                <img src="https://i.imgur.com/on1iU8m.png" alt="Placeholder Image" style="width: 20%; height: auto">
        <% } %>
    </div>







<div class="content is-normal">
        <div><h2><%= recipe.name %> Recipe</h2></div>
        <div><h2>Category: <%= recipe.category %></h2></div>
        <div><h2>Cooking Time: <%= recipe.cookingTime %> Minutes</h2></div>





<!-- ingredients -->
<div class="content">
        <h4>Ingredients:</h4>
            <ul>
                <% recipe.ingredients.forEach(function(eachIngredient) { %>
                    <li><%= eachIngredient %></li>
                <% }); %>
            </ul>
</div>



<div class="content">
    <h3>Cooking Instructions:</h3>
            <ol>
                <% recipe.instructions.forEach(function(eachInstruction) { %>
                    <li><%= eachInstruction %></li>
                <% }); %>
            </ol>
</div>









    
    <!-- FIXME: this needs to move later -->
    <h2>-- move this to "my recipes" page don't forget OAuth --</h2>
    <section>
        <% if (user) { %>
        <form action="/recipes/<%= recipe.id%>/edit" method="GET">
            <button class="button is-warning is-light" type="submit">Edit Recipe</button>
        </form>
        <% } %>
    </section>
    <br><br>










<!-- FIXME: -->
    <section>
        <% if (user) { %>
        <form action="/recipes/<%= recipe._id %>/reviews" method="POST">
            <label>Review:</label>
                <textarea name="content"></textarea><br>
            <label>Rating:</label>
                <input type="submit" value="Add Review">
        </form>
        <% } %>
    </section>
    <br>

    <!-- FIXME: this needs to be centered -->
    <!-- thead is tableHeader, tr is tableRow -->
    <section>
        <% if (recipe.reviews.length) { %>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    <% recipe.reviews.forEach(function(r) { %>
                        <tr>
                            <td><%= r.createdAt.toLocaleDateString() %></td>
                            <td><%= r.content %></td>
                            <td>
                            <% if (user?._id.equals(r.user)) { %>
                                <form action="/reviews/<%= r._id %>?_method=DELETE" method="POST">
                                    <button type="submit">Delete X</button>
                                </form>
                            <% } %>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
            <% } else { %>
                <h5>No Reviews Yet &#128547</h5>
            <% } %>
    </section>


<%- include('../partials/footer') %>